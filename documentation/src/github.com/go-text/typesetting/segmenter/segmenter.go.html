<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Source: segmenter.go in package github.com/go-text/typesetting/segmenter</title>
<link href="../../../../../css/auto-v0.7.1.css" rel="stylesheet">
<script src="../../../../../jvs/golds-v0.7.1.js"></script>
<body onload="onPageLoad()"><div>

<pre id="header"><code><span class="title">Source File</span>
	segmenter.go

<span class="title">Belonging Package</span>
	<a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html">github.com/go-text/typesetting/segmenter</a>
</code></pre>
<style>input[type=radio] {display: none;}
input[id=r0]:checked ~pre label[for=r0],
input[id=r1]:checked ~pre label[for=r1],
input[id=r2]:checked ~pre label[for=r2],
input[id=r3]:checked ~pre label[for=r3],
input[id=r4]:checked ~pre label[for=r4],
input[id=r5]:checked ~pre label[for=r5],
input[id=r6]:checked ~pre label[for=r6],
input[id=r7]:checked ~pre label[for=r7],
input[id=r8]:checked ~pre label[for=r8],
input[id=r9]:checked ~pre label[for=r9],
input[id=r10]:checked ~pre label[for=r10],
input[id=r11]:checked ~pre label[for=r11],
input[id=r12]:checked ~pre label[for=r12],
input[id=r13]:checked ~pre label[for=r13],
input[id=r14]:checked ~pre label[for=r14],
input[id=r15]:checked ~pre label[for=r15],
input[id=r16]:checked ~pre label[for=r16],
input[id=r17]:checked ~pre label[for=r17],
input[id=r18]:checked ~pre label[for=r18],
input[id=r19]:checked ~pre label[for=r19],
input[id=r20]:checked ~pre label[for=r20],
input[id=r21]:checked ~pre label[for=r21],
input[id=r22]:checked ~pre label[for=r22],
input[id=r23]:checked ~pre label[for=r23],
input[id=r24]:checked ~pre label[for=r24],
input[id=r25]:checked ~pre label[for=r25],
input[id=r26]:checked ~pre label[for=r26],
input[id=r27]:checked ~pre label[for=r27],
input[id=r28]:checked ~pre label[for=r28],
input[id=r29]:checked ~pre label[for=r29],
input[id=r30]:checked ~pre label[for=r30],
input[id=r31]:checked ~pre label[for=r31],
input[id=r32]:checked ~pre label[for=r32],
input[id=r33]:checked ~pre label[for=r33],
input[id=r34]:checked ~pre label[for=r34],
input[id=r35]:checked ~pre label[for=r35],
input[id=r36]:checked ~pre label[for=r36],
input[id=r37]:checked ~pre label[for=r37]
{background: #226; color: #ff8;}
input[id=i0]:checked ~pre .i0,
input[id=i1]:checked ~pre .i1
{background: brown; color: #eed;}
</style><input id="r0" type="radio" name="g"/>
<input id="r1" type="radio" name="g"/>
<input id="r2" type="radio" name="g"/>
<input id="r3" type="radio" name="g"/>
<input id="r4" type="radio" name="g"/>
<input id="r5" type="radio" name="g"/>
<input id="r6" type="radio" name="g"/>
<input id="r7" type="radio" name="g"/>
<input id="r8" type="radio" name="g"/>
<input id="r9" type="radio" name="g"/>
<input id="r10" type="radio" name="g"/>
<input id="r11" type="radio" name="g"/>
<input id="r12" type="radio" name="g"/>
<input id="r13" type="radio" name="g"/>
<input id="r14" type="radio" name="g"/>
<input id="r15" type="radio" name="g"/>
<input id="r16" type="radio" name="g"/>
<input id="r17" type="radio" name="g"/>
<input id="r18" type="radio" name="g"/>
<input id="r19" type="radio" name="g"/>
<input id="r20" type="radio" name="g"/>
<input id="r21" type="radio" name="g"/>
<input id="r22" type="radio" name="g"/>
<input id="r23" type="radio" name="g"/>
<input id="r24" type="radio" name="g"/>
<input id="r25" type="radio" name="g"/>
<input id="r26" type="radio" name="g"/>
<input id="r27" type="radio" name="g"/>
<input id="r28" type="radio" name="g"/>
<input id="r29" type="radio" name="g"/>
<input id="r30" type="radio" name="g"/>
<input id="r31" type="radio" name="g"/>
<input id="r32" type="radio" name="g"/>
<input id="r33" type="radio" name="g"/>
<input id="r34" type="radio" name="g"/>
<input id="r35" type="radio" name="g"/>
<input id="r36" type="radio" name="g"/>
<input id="r37" type="radio" name="g"/>
<input id="i0" type="radio" name="i"/>
<input id="i1" type="radio" name="i"/>

<pre class="line-numbers">
<span class="codeline" id="line-1"><code><span class="comment">// SPDX-License-Identifier: Unlicense OR BSD-3-Clause</span></code></span>
<span class="codeline" id="line-2"><code></code></span>
<div class="anchor" id="doc"><span class="codeline" id="line-3"><code><span class="comment">// Package segmenter implements Unicode rules used</span></code></span>
<span class="codeline" id="line-4"><code><span class="comment">// to segment a paragraph of text according to several criteria.</span></code></span>
<span class="codeline" id="line-5"><code><span class="comment">// In particular, it provides a way of delimiting line break opportunities.</span></code></span>
<span class="codeline" id="line-6"><code><span class="comment">//</span></code></span>
<span class="codeline" id="line-7"><code><span class="comment">// The API of the package follows the very nice iterator pattern proposed</span></code></span>
<span class="codeline" id="line-8"><code><span class="comment">// in github.com/npillmayer/uax,</span></code></span>
<span class="codeline" id="line-9"><code><span class="comment">// but use a somewhat simpler internal implementation, inspired by Pango.</span></code></span>
<span class="codeline" id="line-10"><code><span class="comment">//</span></code></span>
<span class="codeline" id="line-11"><code><span class="comment">// The reference documentation is at https://unicode.org/reports/tr14</span></code></span>
<span class="codeline" id="line-12"><code><span class="comment">// and https://unicode.org/reports/tr29.</span></code></span></div><span class="codeline" id="line-13"><code><span class="keyword">package</span> segmenter</code></span>
<span class="codeline" id="line-14"><code></code></span>
<span class="codeline" id="line-15"><code><span class="keyword">import</span> (</code></span>
<span class="codeline" id="line-16"><code>	<label for="i0"><span class="lit-string i0">"unicode"</span></label></code></span>
<span class="codeline" id="line-17"><code></code></span>
<span class="codeline" id="line-18"><code>	<a href="../../../../../pkg/github.com/go-text/typesetting/unicodedata.html" class="ident i1">ucd</a> <label for="i1"><span class="lit-string i1">"github.com/go-text/typesetting/unicodedata"</span></label></code></span>
<span class="codeline" id="line-19"><code>)</code></span>
<span class="codeline" id="line-20"><code></code></span>
<span class="codeline" id="line-21"><code><span class="comment">// breakAttr is a flag storing the break properties between two runes of</span></code></span>
<span class="codeline" id="line-22"><code><span class="comment">// the input text.</span></code></span>
<span class="codeline" id="line-23"><code><span class="keyword">type</span> <a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-breakAttr" class="ident">breakAttr</a> <a href="../../../../../pkg/builtin.html#name-uint8" class="ident">uint8</a></code></span>
<span class="codeline" id="line-24"><code></code></span>
<span class="codeline" id="line-25"><code><span class="keyword">const</span> (</code></span>
<span class="codeline" id="line-26"><code>	<a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-lineBoundary" class="ident">lineBoundary</a>          <a href="#line-23" class="ident">breakAttr</a> = <span class="lit-number">1</span> &lt;&lt; <a href="../../../../../pkg/builtin.html#name-iota" class="ident">iota</a></code></span>
<span class="codeline" id="line-27"><code>	<a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-mandatoryLineBoundary" class="ident">mandatoryLineBoundary</a>           <span class="comment">// implies LineBoundary</span></code></span>
<span class="codeline" id="line-28"><code></code></span>
<span class="codeline" id="line-29"><code>	<span class="comment">// graphemeBoundary is on if the cursor can appear in front of a character,</span></code></span>
<span class="codeline" id="line-30"><code><span class="comment">	// i.e. if we are at a grapheme boundary.</span></code></span>
<span class="codeline" id="line-31"><code>	<a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-graphemeBoundary" class="ident">graphemeBoundary</a></code></span>
<span class="codeline" id="line-32"><code></code></span>
<span class="codeline" id="line-33"><code>	<span class="comment">// wordBoundary is on if we are at the beginning or end of a word.</span></code></span>
<span class="codeline" id="line-34"><code><span class="comment">	//</span></code></span>
<span class="codeline" id="line-35"><code><span class="comment">	// To actually detect words, you should also look for runes</span></code></span>
<span class="codeline" id="line-36"><code><span class="comment">	// with the [Alphabetic] property, or with a General_Category of Number.</span></code></span>
<span class="codeline" id="line-37"><code><span class="comment">	//</span></code></span>
<span class="codeline" id="line-38"><code><span class="comment">	// See also https://unicode.org/reports/tr29/#Word_Boundary_Rules,</span></code></span>
<span class="codeline" id="line-39"><code><span class="comment">	// http://unicode.org/reports/tr44/#Alphabetic and</span></code></span>
<span class="codeline" id="line-40"><code><span class="comment">	// http://unicode.org/reports/tr44/#General_Category_Values</span></code></span>
<span class="codeline" id="line-41"><code>	<a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-wordBoundary" class="ident">wordBoundary</a></code></span>
<span class="codeline" id="line-42"><code>)</code></span>
<span class="codeline" id="line-43"><code></code></span>
<span class="codeline" id="line-44"><code><span class="keyword">const</span> <a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-paragraphSeparator" class="ident">paragraphSeparator</a> <a href="../../../../../pkg/builtin.html#name-rune" class="ident">rune</a> = <span class="lit-number">0x2029</span></code></span>
<span class="codeline" id="line-45"><code></code></span>
<span class="codeline" id="line-46"><code><span class="comment">// lineBreakClass stores the Line Break Property</span></code></span>
<span class="codeline" id="line-47"><code><span class="comment">// See https://unicode.org/reports/tr14/#Properties</span></code></span>
<span class="codeline" id="line-48"><code><span class="keyword">type</span> <a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-lineBreakClass" class="ident">lineBreakClass</a> = *<a href="../../../../../pkg/unicode.html" class="ident i0">unicode</a>.<a href="../../../../unicode/letter.go.html#line-21" class="ident">RangeTable</a></code></span>
<span class="codeline" id="line-49"><code></code></span>
<span class="codeline" id="line-50"><code><span class="comment">// graphemeBreakClass stores the Unicode Grapheme Cluster Break Property</span></code></span>
<span class="codeline" id="line-51"><code><span class="comment">// See https://unicode.org/reports/tr29/#Grapheme_Cluster_Break_Property_Values</span></code></span>
<span class="codeline" id="line-52"><code><span class="keyword">type</span> <a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-graphemeBreakClass" class="ident">graphemeBreakClass</a> = *<a href="../../../../../pkg/unicode.html" class="ident i0">unicode</a>.<a href="../../../../unicode/letter.go.html#line-21" class="ident">RangeTable</a></code></span>
<span class="codeline" id="line-53"><code></code></span>
<span class="codeline" id="line-54"><code><span class="comment">// wordBreakClass stores the Unicode Word Break Property</span></code></span>
<span class="codeline" id="line-55"><code><span class="comment">// See https://unicode.org/reports/tr29/#Table_Word_Break_Property_Values</span></code></span>
<span class="codeline" id="line-56"><code><span class="keyword">type</span> <a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-wordBreakClass" class="ident">wordBreakClass</a> = *<a href="../../../../../pkg/unicode.html" class="ident i0">unicode</a>.<a href="../../../../unicode/letter.go.html#line-21" class="ident">RangeTable</a></code></span>
<span class="codeline" id="line-57"><code></code></span>
<span class="codeline" id="line-58"><code><span class="comment">// cursor holds the information for the current index</span></code></span>
<span class="codeline" id="line-59"><code><span class="comment">// processed by `computeAttributes`, that is</span></code></span>
<span class="codeline" id="line-60"><code><span class="comment">// the context provided by previous and next runes in the text</span></code></span>
<span class="codeline" id="line-61"><code><span class="keyword">type</span> <a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-cursor" class="ident">cursor</a> <span class="keyword">struct</span> {</code></span>
<span class="codeline" id="line-62"><code>	prev <a href="../../../../../pkg/builtin.html#name-rune" class="ident">rune</a> <span class="comment">// the rune at index i-1</span></code></span>
<span class="codeline" id="line-63"><code>	r    <a href="../../../../../pkg/builtin.html#name-rune" class="ident">rune</a> <span class="comment">// the rune at index i</span></code></span>
<span class="codeline" id="line-64"><code>	next <a href="../../../../../pkg/builtin.html#name-rune" class="ident">rune</a> <span class="comment">// the rune at index i+1</span></code></span>
<span class="codeline" id="line-65"><code></code></span>
<span class="codeline" id="line-66"><code>	<span class="comment">// is r included in `ucd.Extended_Pictographic`,</span></code></span>
<span class="codeline" id="line-67"><code><span class="comment">	// cached for efficiency</span></code></span>
<span class="codeline" id="line-68"><code>	isExtentedPic <a href="../../../../../pkg/builtin.html#name-bool" class="ident">bool</a></code></span>
<span class="codeline" id="line-69"><code></code></span>
<span class="codeline" id="line-70"><code>	<span class="comment">// the following fields persists across iterations</span></code></span>
<span class="codeline" id="line-71"><code></code></span>
<span class="codeline" id="line-72"><code>	prevGrapheme <a href="#line-52" class="ident">graphemeBreakClass</a> <span class="comment">// the Grapheme Break property at index i-1</span></code></span>
<span class="codeline" id="line-73"><code>	grapheme     <a href="#line-52" class="ident">graphemeBreakClass</a> <span class="comment">// the Grapheme Break property at index i</span></code></span>
<span class="codeline" id="line-74"><code></code></span>
<span class="codeline" id="line-75"><code>	<span class="comment">// true if the `prev` rune was an odd Regional_Indicator, false if it was even or not an RI</span></code></span>
<span class="codeline" id="line-76"><code><span class="comment">	// used for rules GB12 and GB13</span></code></span>
<span class="codeline" id="line-77"><code><span class="comment">	// see [updateGraphemeRIOdd]</span></code></span>
<span class="codeline" id="line-78"><code>	isPrevGraphemeRIOdd <a href="../../../../../pkg/builtin.html#name-bool" class="ident">bool</a></code></span>
<span class="codeline" id="line-79"><code></code></span>
<span class="codeline" id="line-80"><code>	prevPrevWord     <a href="#line-56" class="ident">wordBreakClass</a> <span class="comment">// the Word Break property at the previous previous, non Extend rune</span></code></span>
<span class="codeline" id="line-81"><code>	prevWord         <a href="#line-56" class="ident">wordBreakClass</a> <span class="comment">// the Word Break property at the previous, non Extend rune</span></code></span>
<span class="codeline" id="line-82"><code>	word             <a href="#line-56" class="ident">wordBreakClass</a> <span class="comment">// the Word Break property at index i</span></code></span>
<span class="codeline" id="line-83"><code>	prevWordNoExtend <a href="../../../../../pkg/builtin.html#name-int" class="ident">int</a>            <span class="comment">// the index of the last rune NOT having a Extend word break property</span></code></span>
<span class="codeline" id="line-84"><code></code></span>
<span class="codeline" id="line-85"><code>	<span class="comment">// true if the `prev` rune was an odd Regional_Indicator, false if it was even or not an RI</span></code></span>
<span class="codeline" id="line-86"><code><span class="comment">	// used for rules WB15 and WB16</span></code></span>
<span class="codeline" id="line-87"><code><span class="comment">	// see [updateWordRIOdd]</span></code></span>
<span class="codeline" id="line-88"><code>	isPrevWordRIOdd <a href="../../../../../pkg/builtin.html#name-bool" class="ident">bool</a></code></span>
<span class="codeline" id="line-89"><code></code></span>
<span class="codeline" id="line-90"><code>	prevPrevLine <a href="#line-48" class="ident">lineBreakClass</a> <span class="comment">// the Line Break Class at index i-2 (see rules LB9 and LB10 for edge cases)</span></code></span>
<span class="codeline" id="line-91"><code>	prevLine     <a href="#line-48" class="ident">lineBreakClass</a> <span class="comment">// the Line Break Class at index i-1 (see rules LB9 and LB10 for edge cases)</span></code></span>
<span class="codeline" id="line-92"><code>	line         <a href="#line-48" class="ident">lineBreakClass</a> <span class="comment">// the Line Break Class at index i</span></code></span>
<span class="codeline" id="line-93"><code>	nextLine     <a href="#line-48" class="ident">lineBreakClass</a> <span class="comment">// the Line Break Class at index i+1</span></code></span>
<span class="codeline" id="line-94"><code></code></span>
<span class="codeline" id="line-95"><code>	<span class="comment">// the last rune after spaces, used in rules LB14,LB15,LB16,LB17</span></code></span>
<span class="codeline" id="line-96"><code><span class="comment">	// to match ... SP* ...</span></code></span>
<span class="codeline" id="line-97"><code>	beforeSpaces <a href="#line-48" class="ident">lineBreakClass</a></code></span>
<span class="codeline" id="line-98"><code></code></span>
<span class="codeline" id="line-99"><code>	<span class="comment">// true if the `prev` rune was an odd Regional_Indicator, false if it was even or not an RI</span></code></span>
<span class="codeline" id="line-100"><code><span class="comment">	// used for rules LB30a</span></code></span>
<span class="codeline" id="line-101"><code>	isPrevLinebreakRIOdd <a href="../../../../../pkg/builtin.html#name-bool" class="ident">bool</a></code></span>
<span class="codeline" id="line-102"><code></code></span>
<span class="codeline" id="line-103"><code>	<span class="comment">// are we in a numeric sequence, as defined in Example 7 of customisation for LB25</span></code></span>
<span class="codeline" id="line-104"><code>	numSequence <a href="unicode14_rules.go.html#line-327" class="ident">numSequenceState</a></code></span>
<span class="codeline" id="line-105"><code></code></span>
<span class="codeline" id="line-106"><code>	<span class="comment">// are we in an emoji sequence, as defined in rule GB11</span></code></span>
<span class="codeline" id="line-107"><code><span class="comment">	// see [updatePictoSequence]</span></code></span>
<span class="codeline" id="line-108"><code>	pictoSequence <a href="unicode29_rules.go.html#line-61" class="ident">pictoSequenceState</a></code></span>
<span class="codeline" id="line-109"><code>}</code></span>
<span class="codeline" id="line-110"><code></code></span>
<span class="codeline" id="line-111"><code><span class="comment">// initialise the cursor properties</span></code></span>
<span class="codeline" id="line-112"><code><span class="comment">// some of them are set in [startIteration]</span></code></span>
<span class="codeline" id="line-113"><code><span class="keyword">func</span> <label for="r0" class="ident"><a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-newCursor" class="ident">newCursor</a></label>(<label for="r1" class="ident">text</label> []<a href="../../../../../pkg/builtin.html#name-rune" class="ident">rune</a>) *<a href="#line-61" class="ident">cursor</a> {</code></span>
<span class="codeline" id="line-114"><code>	<label for="r2" class="ident">cr</label> := <a href="#line-61" class="ident">cursor</a>{</code></span>
<span class="codeline" id="line-115"><code>		<a href="#line-90" class="ident">prevPrevLine</a>:     <a href="../../../../../pkg/github.com/go-text/typesetting/unicodedata.html" class="ident i1">ucd</a>.<a href="../unicodedata/linebreak.go.html#line-2441" class="ident">BreakXX</a>,</code></span>
<span class="codeline" id="line-116"><code>		<a href="#line-83" class="ident">prevWordNoExtend</a>: -<span class="lit-number">1</span>,</code></span>
<span class="codeline" id="line-117"><code>	}</code></span>
<span class="codeline" id="line-118"><code></code></span>
<span class="codeline" id="line-119"><code>	<span class="comment">// `startIteration` set `breakCl` from `nextBreakCl`</span></code></span>
<span class="codeline" id="line-120"><code><span class="comment">	// so we need to init this field before the first iteration</span></code></span>
<span class="codeline" id="line-121"><code>	<label for="r2" class="ident">cr</label>.<a href="#line-93" class="ident">nextLine</a> = <a href="../../../../../pkg/github.com/go-text/typesetting/unicodedata.html" class="ident i1">ucd</a>.<a href="../unicodedata/linebreak.go.html#line-2441" class="ident">BreakXX</a></code></span>
<span class="codeline" id="line-122"><code>	<span class="keyword">if</span> <a href="../../../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r1" class="ident">text</label>) != <span class="lit-number">0</span> {</code></span>
<span class="codeline" id="line-123"><code>		<label for="r2" class="ident">cr</label>.<a href="#line-93" class="ident">nextLine</a> = <a href="../../../../../pkg/github.com/go-text/typesetting/unicodedata.html" class="ident i1">ucd</a>.<a href="../unicodedata/unicode.go.html#line-53" class="ident">LookupLineBreakClass</a>(<label for="r1" class="ident">text</label>[<span class="lit-number">0</span>])</code></span>
<span class="codeline" id="line-124"><code>	}</code></span>
<span class="codeline" id="line-125"><code>	<span class="keyword">return</span> &amp;<label for="r2" class="ident">cr</label></code></span>
<span class="codeline" id="line-126"><code>}</code></span>
<span class="codeline" id="line-127"><code></code></span>
<span class="codeline" id="line-128"><code><span class="comment">// computeBreakAttributes does the heavy lifting of text segmentation,</span></code></span>
<span class="codeline" id="line-129"><code><span class="comment">// by computing a break attribute for each rune.</span></code></span>
<span class="codeline" id="line-130"><code><span class="comment">//</span></code></span>
<span class="codeline" id="line-131"><code><span class="comment">// More precisely, `attributes` must be a slice of length len(text)+1,</span></code></span>
<span class="codeline" id="line-132"><code><span class="comment">// which will be filled at index i by the attribute describing the</span></code></span>
<span class="codeline" id="line-133"><code><span class="comment">// break between rune at index i-1 and index i.</span></code></span>
<span class="codeline" id="line-134"><code><span class="comment">//</span></code></span>
<span class="codeline" id="line-135"><code><span class="comment">// Unicode defines a lot of properties; for now we only handle</span></code></span>
<span class="codeline" id="line-136"><code><span class="comment">// grapheme, word and line breaking.</span></code></span>
<span class="codeline" id="line-137"><code><span class="keyword">func</span> <label for="r3" class="ident"><a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-computeBreakAttributes" class="ident">computeBreakAttributes</a></label>(<label for="r4" class="ident">text</label> []<a href="../../../../../pkg/builtin.html#name-rune" class="ident">rune</a>, <label for="r5" class="ident">attributes</label> []<a href="#line-23" class="ident">breakAttr</a>) {</code></span>
<span class="codeline" id="line-138"><code>	<span class="comment">// The rules are somewhat complex, but the general logic is pretty simple:</span></code></span>
<span class="codeline" id="line-139"><code><span class="comment">	// iterate through the input slice, fetch context information</span></code></span>
<span class="codeline" id="line-140"><code><span class="comment">	// from previous and following runes required by the rules,</span></code></span>
<span class="codeline" id="line-141"><code><span class="comment">	// and finaly apply them.</span></code></span>
<span class="codeline" id="line-142"><code><span class="comment">	// Some rules require variable length lookup, which we handle by keeping</span></code></span>
<span class="codeline" id="line-143"><code><span class="comment">	// a state in a [cursor] object.</span></code></span>
<span class="codeline" id="line-144"><code></code></span>
<span class="codeline" id="line-145"><code>	<span class="comment">// initialise the cursor properties</span></code></span>
<span class="codeline" id="line-146"><code>	<label for="r6" class="ident">cr</label> := <a href="#line-113" class="ident">newCursor</a>(<label for="r4" class="ident">text</label>)</code></span>
<span class="codeline" id="line-147"><code></code></span>
<span class="codeline" id="line-148"><code>	<span class="keyword">for</span> <label for="r7" class="ident">i</label> := <span class="lit-number">0</span>; <label for="r7" class="ident">i</label> &lt;= <a href="../../../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r4" class="ident">text</label>); <label for="r7" class="ident">i</label>++ { <span class="comment">// note that we accept i == len(text) to fill the last attribute</span></code></span>
<span class="codeline" id="line-149"><code>		<label for="r6" class="ident">cr</label>.<a href="unicode14_rules.go.html#line-383" class="ident">startIteration</a>(<label for="r4" class="ident">text</label>, <label for="r7" class="ident">i</label>)</code></span>
<span class="codeline" id="line-150"><code></code></span>
<span class="codeline" id="line-151"><code>		<span class="keyword">var</span> <label for="r8" class="ident">attr</label> <a href="#line-23" class="ident">breakAttr</a></code></span>
<span class="codeline" id="line-152"><code></code></span>
<span class="codeline" id="line-153"><code>		<span class="comment">// UAX#29 Grapheme and word Boundaries</span></code></span>
<span class="codeline" id="line-154"><code></code></span>
<span class="codeline" id="line-155"><code>		<label for="r9" class="ident">isGraphemeBoundary</label> := <label for="r6" class="ident">cr</label>.<a href="unicode29_rules.go.html#line-16" class="ident">applyGraphemeBoundaryRules</a>()</code></span>
<span class="codeline" id="line-156"><code>		<span class="keyword">if</span> <label for="r9" class="ident">isGraphemeBoundary</label> {</code></span>
<span class="codeline" id="line-157"><code>			<label for="r8" class="ident">attr</label> |= <a href="#line-31" class="ident">graphemeBoundary</a></code></span>
<span class="codeline" id="line-158"><code>		}</code></span>
<span class="codeline" id="line-159"><code></code></span>
<span class="codeline" id="line-160"><code>		<label for="r10" class="ident">isWordBoundary</label>, <label for="r11" class="ident">removePrevNoExtend</label> := <label for="r6" class="ident">cr</label>.<a href="unicode29_rules.go.html#line-130" class="ident">applyWordBoundaryRules</a>(<label for="r7" class="ident">i</label>)</code></span>
<span class="codeline" id="line-161"><code>		<span class="keyword">if</span> <label for="r10" class="ident">isWordBoundary</label> {</code></span>
<span class="codeline" id="line-162"><code>			<label for="r8" class="ident">attr</label> |= <a href="#line-41" class="ident">wordBoundary</a></code></span>
<span class="codeline" id="line-163"><code>		}</code></span>
<span class="codeline" id="line-164"><code>		<span class="keyword">if</span> <label for="r11" class="ident">removePrevNoExtend</label> {</code></span>
<span class="codeline" id="line-165"><code>			<label for="r5" class="ident">attributes</label>[<label for="r6" class="ident">cr</label>.<a href="#line-83" class="ident">prevWordNoExtend</a>] &amp;^= <a href="#line-41" class="ident">wordBoundary</a></code></span>
<span class="codeline" id="line-166"><code>		}</code></span>
<span class="codeline" id="line-167"><code></code></span>
<span class="codeline" id="line-168"><code>		<span class="comment">// UAX#14 Line Breaking</span></code></span>
<span class="codeline" id="line-169"><code></code></span>
<span class="codeline" id="line-170"><code>		<label for="r12" class="ident">bo</label> := <label for="r6" class="ident">cr</label>.<a href="unicode14_rules.go.html#line-13" class="ident">applyLineBoundaryRules</a>()</code></span>
<span class="codeline" id="line-171"><code>		<span class="keyword">switch</span> <label for="r12" class="ident">bo</label> {</code></span>
<span class="codeline" id="line-172"><code>		<span class="keyword">case</span> <a href="unicode14_rules.go.html#line-41" class="ident">breakEmpty</a>:</code></span>
<span class="codeline" id="line-173"><code>			<span class="comment">// rule LB31 : default to allow line break</span></code></span>
<span class="codeline" id="line-174"><code>			<label for="r8" class="ident">attr</label> |= <a href="#line-26" class="ident">lineBoundary</a></code></span>
<span class="codeline" id="line-175"><code>		<span class="keyword">case</span> <a href="unicode14_rules.go.html#line-42" class="ident">breakProhibited</a>:</code></span>
<span class="codeline" id="line-176"><code>			<label for="r8" class="ident">attr</label> &amp;^= <a href="#line-26" class="ident">lineBoundary</a></code></span>
<span class="codeline" id="line-177"><code>		<span class="keyword">case</span> <a href="unicode14_rules.go.html#line-43" class="ident">breakAllowed</a>:</code></span>
<span class="codeline" id="line-178"><code>			<label for="r8" class="ident">attr</label> |= <a href="#line-26" class="ident">lineBoundary</a></code></span>
<span class="codeline" id="line-179"><code>		<span class="keyword">case</span> <a href="unicode14_rules.go.html#line-44" class="ident">breakMandatory</a>:</code></span>
<span class="codeline" id="line-180"><code>			<label for="r8" class="ident">attr</label> |= <a href="#line-26" class="ident">lineBoundary</a></code></span>
<span class="codeline" id="line-181"><code>			<label for="r8" class="ident">attr</label> |= <a href="#line-27" class="ident">mandatoryLineBoundary</a></code></span>
<span class="codeline" id="line-182"><code>		}</code></span>
<span class="codeline" id="line-183"><code></code></span>
<span class="codeline" id="line-184"><code>		<label for="r6" class="ident">cr</label>.<a href="unicode14_rules.go.html#line-421" class="ident">endIteration</a>(<label for="r7" class="ident">i</label> == <span class="lit-number">0</span>)</code></span>
<span class="codeline" id="line-185"><code></code></span>
<span class="codeline" id="line-186"><code>		<label for="r5" class="ident">attributes</label>[<label for="r7" class="ident">i</label>] = <label for="r8" class="ident">attr</label></code></span>
<span class="codeline" id="line-187"><code>	}</code></span>
<span class="codeline" id="line-188"><code></code></span>
<span class="codeline" id="line-189"><code>	<span class="comment">// start and end of the paragraph are always</span></code></span>
<span class="codeline" id="line-190"><code><span class="comment">	// grapheme boundaries and word boundaries</span></code></span>
<span class="codeline" id="line-191"><code>	<label for="r5" class="ident">attributes</label>[<span class="lit-number">0</span>] |= <a href="#line-31" class="ident">graphemeBoundary</a> | <a href="#line-41" class="ident">wordBoundary</a>         <span class="comment">// Rule GB1 and WB1</span></code></span>
<span class="codeline" id="line-192"><code>	<label for="r5" class="ident">attributes</label>[<a href="../../../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r4" class="ident">text</label>)] |= <a href="#line-31" class="ident">graphemeBoundary</a> | <a href="#line-41" class="ident">wordBoundary</a> <span class="comment">// Rule GB2 and WB2</span></code></span>
<span class="codeline" id="line-193"><code></code></span>
<span class="codeline" id="line-194"><code>	<span class="comment">// never break before the first char,</span></code></span>
<span class="codeline" id="line-195"><code><span class="comment">	// but always break after the last</span></code></span>
<span class="codeline" id="line-196"><code>	<label for="r5" class="ident">attributes</label>[<span class="lit-number">0</span>] &amp;^= <a href="#line-26" class="ident">lineBoundary</a>                 <span class="comment">// Rule LB2</span></code></span>
<span class="codeline" id="line-197"><code>	<label for="r5" class="ident">attributes</label>[<a href="../../../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r4" class="ident">text</label>)] |= <a href="#line-26" class="ident">lineBoundary</a>          <span class="comment">// Rule LB3</span></code></span>
<span class="codeline" id="line-198"><code>	<label for="r5" class="ident">attributes</label>[<a href="../../../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r4" class="ident">text</label>)] |= <a href="#line-27" class="ident">mandatoryLineBoundary</a> <span class="comment">// Rule LB3</span></code></span>
<span class="codeline" id="line-199"><code>}</code></span>
<span class="codeline" id="line-200"><code></code></span>
<span class="codeline" id="line-201"><code><span class="comment">// Segmenter is the entry point of the package.</span></code></span>
<span class="codeline" id="line-202"><code><span class="comment">//</span></code></span>
<span class="codeline" id="line-203"><code><span class="comment">// Usage :</span></code></span>
<span class="codeline" id="line-204"><code><span class="comment">//</span></code></span>
<span class="codeline" id="line-205"><code><span class="comment">//	var seg Segmenter</span></code></span>
<span class="codeline" id="line-206"><code><span class="comment">//	seg.Init(...)</span></code></span>
<span class="codeline" id="line-207"><code><span class="comment">//	iter := seg.LineIterator()</span></code></span>
<span class="codeline" id="line-208"><code><span class="comment">//	for iter.Next() {</span></code></span>
<span class="codeline" id="line-209"><code><span class="comment">//	  ... // do something with iter.Line()</span></code></span>
<span class="codeline" id="line-210"><code><span class="comment">//	}</span></code></span>
<span class="codeline" id="line-211"><code><span class="keyword">type</span> <a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-Segmenter" class="ident">Segmenter</a> <span class="keyword">struct</span> {</code></span>
<span class="codeline" id="line-212"><code>	text []<a href="../../../../../pkg/builtin.html#name-rune" class="ident">rune</a></code></span>
<span class="codeline" id="line-213"><code>	<span class="comment">// with length len(text) + 1 :</span></code></span>
<span class="codeline" id="line-214"><code><span class="comment">	// the attribute at indice i is about the</span></code></span>
<span class="codeline" id="line-215"><code><span class="comment">	// rune at i-1 and i.</span></code></span>
<span class="codeline" id="line-216"><code><span class="comment">	// See also [ComputeBreakAttributes]</span></code></span>
<span class="codeline" id="line-217"><code><span class="comment">	// Example :</span></code></span>
<span class="codeline" id="line-218"><code><span class="comment">	// 	text : 			[b, 		u, 	l, 	l]</span></code></span>
<span class="codeline" id="line-219"><code><span class="comment">	// 	attributes :	[&lt;start&gt; b, b u, u l, l l, l &lt;end&gt;]</span></code></span>
<span class="codeline" id="line-220"><code>	attributes []<a href="#line-23" class="ident">breakAttr</a></code></span>
<span class="codeline" id="line-221"><code>}</code></span>
<span class="codeline" id="line-222"><code></code></span>
<span class="codeline" id="line-223"><code><span class="comment">// Init resets the segmenter storage with the given input,</span></code></span>
<span class="codeline" id="line-224"><code><span class="comment">// and computes the attributes required to segment the text.</span></code></span>
<span class="codeline" id="line-225"><code><span class="keyword">func</span> (<label for="r13" class="ident">seg</label> *<a href="#line-211" class="ident">Segmenter</a>) <label for="r14" class="ident">Init</label>(<label for="r15" class="ident">paragraph</label> []<a href="../../../../../pkg/builtin.html#name-rune" class="ident">rune</a>) {</code></span>
<span class="codeline" id="line-226"><code>	<label for="r13" class="ident">seg</label>.<a href="#line-212" class="ident">text</a> = <a href="../../../../../pkg/builtin.html#name-append" class="ident">append</a>(<label for="r13" class="ident">seg</label>.<a href="#line-212" class="ident">text</a>[:<span class="lit-number">0</span>], <label for="r15" class="ident">paragraph</label>...)</code></span>
<span class="codeline" id="line-227"><code>	<label for="r13" class="ident">seg</label>.<a href="#line-220" class="ident">attributes</a> = <a href="../../../../../pkg/builtin.html#name-append" class="ident">append</a>(<label for="r13" class="ident">seg</label>.<a href="#line-220" class="ident">attributes</a>[:<span class="lit-number">0</span>], <a href="../../../../../pkg/builtin.html#name-make" class="ident">make</a>([]<a href="#line-23" class="ident">breakAttr</a>, <a href="../../../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r15" class="ident">paragraph</label>)+<span class="lit-number">1</span>)...)</code></span>
<span class="codeline" id="line-228"><code>	<a href="#line-137" class="ident">computeBreakAttributes</a>(<label for="r13" class="ident">seg</label>.<a href="#line-212" class="ident">text</a>, <label for="r13" class="ident">seg</label>.<a href="#line-220" class="ident">attributes</a>)</code></span>
<span class="codeline" id="line-229"><code>}</code></span>
<span class="codeline" id="line-230"><code></code></span>
<span class="codeline" id="line-231"><code><span class="comment">// attributeIterator is an helper type used to</span></code></span>
<span class="codeline" id="line-232"><code><span class="comment">// handle iterating over a slice of runeAttr</span></code></span>
<span class="codeline" id="line-233"><code><span class="keyword">type</span> <a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-attributeIterator" class="ident">attributeIterator</a> <span class="keyword">struct</span> {</code></span>
<span class="codeline" id="line-234"><code>	src       *<a href="#line-211" class="ident">Segmenter</a></code></span>
<span class="codeline" id="line-235"><code>	pos       <a href="../../../../../pkg/builtin.html#name-int" class="ident">int</a>       <span class="comment">// the current position in the input slice</span></code></span>
<span class="codeline" id="line-236"><code>	lastBreak <a href="../../../../../pkg/builtin.html#name-int" class="ident">int</a>       <span class="comment">// the start of the current segment</span></code></span>
<span class="codeline" id="line-237"><code>	flag      <a href="#line-23" class="ident">breakAttr</a> <span class="comment">// break where this flag is on</span></code></span>
<span class="codeline" id="line-238"><code>}</code></span>
<span class="codeline" id="line-239"><code></code></span>
<span class="codeline" id="line-240"><code><span class="comment">// next returns true if there is still a segment to process,</span></code></span>
<span class="codeline" id="line-241"><code><span class="comment">// and advances the iterator; or return false.</span></code></span>
<span class="codeline" id="line-242"><code><span class="comment">// if returning true, the segment is at [iter.lastBreak:iter.pos]</span></code></span>
<span class="codeline" id="line-243"><code><span class="keyword">func</span> (<label for="r16" class="ident">iter</label> *<a href="#line-233" class="ident">attributeIterator</a>) <label for="r17" class="ident">next</label>() <a href="../../../../../pkg/builtin.html#name-bool" class="ident">bool</a> {</code></span>
<span class="codeline" id="line-244"><code>	<label for="r16" class="ident">iter</label>.<a href="#line-236" class="ident">lastBreak</a> = <label for="r16" class="ident">iter</label>.<a href="#line-235" class="ident">pos</a> <span class="comment">// remember the start of the next segment</span></code></span>
<span class="codeline" id="line-245"><code>	<label for="r16" class="ident">iter</label>.<a href="#line-235" class="ident">pos</a>++</code></span>
<span class="codeline" id="line-246"><code>	<span class="keyword">for</span> <label for="r16" class="ident">iter</label>.<a href="#line-235" class="ident">pos</a> &lt;= <a href="../../../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r16" class="ident">iter</label>.<a href="#line-234" class="ident">src</a>.<a href="#line-212" class="ident">text</a>) {</code></span>
<span class="codeline" id="line-247"><code>		<span class="comment">// can we break before i ?</span></code></span>
<span class="codeline" id="line-248"><code>		<span class="keyword">if</span> <label for="r16" class="ident">iter</label>.<a href="#line-234" class="ident">src</a>.<a href="#line-220" class="ident">attributes</a>[<label for="r16" class="ident">iter</label>.<a href="#line-235" class="ident">pos</a>]&amp;<label for="r16" class="ident">iter</label>.<a href="#line-237" class="ident">flag</a> != <span class="lit-number">0</span> {</code></span>
<span class="codeline" id="line-249"><code>			<span class="keyword">return</span> <a href="../../../../../pkg/builtin.html#name-true" class="ident">true</a></code></span>
<span class="codeline" id="line-250"><code>		}</code></span>
<span class="codeline" id="line-251"><code>		<label for="r16" class="ident">iter</label>.<a href="#line-235" class="ident">pos</a>++</code></span>
<span class="codeline" id="line-252"><code>	}</code></span>
<span class="codeline" id="line-253"><code>	<span class="keyword">return</span> <a href="../../../../../pkg/builtin.html#name-false" class="ident">false</a></code></span>
<span class="codeline" id="line-254"><code>}</code></span>
<span class="codeline" id="line-255"><code></code></span>
<span class="codeline" id="line-256"><code><span class="comment">// Line is the content of a line delimited by the segmenter.</span></code></span>
<span class="codeline" id="line-257"><code><span class="keyword">type</span> <a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-Line" class="ident">Line</a> <span class="keyword">struct</span> {</code></span>
<span class="codeline" id="line-258"><code>	<span class="comment">// Text is a subslice of the original input slice, containing the delimited line</span></code></span>
<span class="codeline" id="line-259"><code>	Text []<a href="../../../../../pkg/builtin.html#name-rune" class="ident">rune</a></code></span>
<span class="codeline" id="line-260"><code>	<span class="comment">// Offset is the start of the line in the input rune slice</span></code></span>
<span class="codeline" id="line-261"><code>	Offset <a href="../../../../../pkg/builtin.html#name-int" class="ident">int</a></code></span>
<span class="codeline" id="line-262"><code>	<span class="comment">// IsMandatoryBreak is true if breaking (at the end of the line)</span></code></span>
<span class="codeline" id="line-263"><code><span class="comment">	// is mandatory</span></code></span>
<span class="codeline" id="line-264"><code>	IsMandatoryBreak <a href="../../../../../pkg/builtin.html#name-bool" class="ident">bool</a></code></span>
<span class="codeline" id="line-265"><code>}</code></span>
<span class="codeline" id="line-266"><code></code></span>
<span class="codeline" id="line-267"><code><span class="comment">// LineIterator provides a convenient way of</span></code></span>
<span class="codeline" id="line-268"><code><span class="comment">// iterating over the lines delimited by a `Segmenter`.</span></code></span>
<span class="codeline" id="line-269"><code><span class="keyword">type</span> <a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-LineIterator" class="ident">LineIterator</a> <span class="keyword">struct</span> {</code></span>
<span class="codeline" id="line-270"><code>	<a href="#line-233" class="ident">attributeIterator</a></code></span>
<span class="codeline" id="line-271"><code>}</code></span>
<span class="codeline" id="line-272"><code></code></span>
<span class="codeline" id="line-273"><code><span class="comment">// Next returns true if there is still a line to process,</span></code></span>
<span class="codeline" id="line-274"><code><span class="comment">// and advances the iterator; or return false.</span></code></span>
<span class="codeline" id="line-275"><code><span class="keyword">func</span> (<label for="r18" class="ident">li</label> *<a href="#line-269" class="ident">LineIterator</a>) <label for="r19" class="ident">Next</label>() <a href="../../../../../pkg/builtin.html#name-bool" class="ident">bool</a> { <span class="keyword">return</span> <label for="r18" class="ident">li</label>.<a href="#line-243" class="ident">next</a>() }</code></span>
<span class="codeline" id="line-276"><code></code></span>
<span class="codeline" id="line-277"><code><span class="comment">// Line returns the current `Line`</span></code></span>
<span class="codeline" id="line-278"><code><span class="keyword">func</span> (<label for="r20" class="ident">li</label> *<a href="#line-269" class="ident">LineIterator</a>) <label for="r21" class="ident">Line</label>() <a href="#line-257" class="ident">Line</a> {</code></span>
<span class="codeline" id="line-279"><code>	<span class="keyword">return</span> <a href="#line-257" class="ident">Line</a>{</code></span>
<span class="codeline" id="line-280"><code>		<a href="#line-261" class="ident">Offset</a>:           <label for="r20" class="ident">li</label>.<a href="#line-236" class="ident">lastBreak</a>,</code></span>
<span class="codeline" id="line-281"><code>		<a href="#line-259" class="ident">Text</a>:             <label for="r20" class="ident">li</label>.<a href="#line-234" class="ident">src</a>.<a href="#line-212" class="ident">text</a>[<label for="r20" class="ident">li</label>.<a href="#line-236" class="ident">lastBreak</a>:<label for="r20" class="ident">li</label>.<a href="#line-235" class="ident">pos</a>], <span class="comment">// pos is not included since we break right before</span></code></span>
<span class="codeline" id="line-282"><code>		<a href="#line-264" class="ident">IsMandatoryBreak</a>: <label for="r20" class="ident">li</label>.<a href="#line-234" class="ident">src</a>.<a href="#line-220" class="ident">attributes</a>[<label for="r20" class="ident">li</label>.<a href="#line-235" class="ident">pos</a>]&amp;<a href="#line-27" class="ident">mandatoryLineBoundary</a> != <span class="lit-number">0</span>,</code></span>
<span class="codeline" id="line-283"><code>	}</code></span>
<span class="codeline" id="line-284"><code>}</code></span>
<span class="codeline" id="line-285"><code></code></span>
<span class="codeline" id="line-286"><code><span class="comment">// LineIterator returns an iterator on the lines</span></code></span>
<span class="codeline" id="line-287"><code><span class="comment">// delimited in [Init].</span></code></span>
<span class="codeline" id="line-288"><code><span class="keyword">func</span> (<label for="r22" class="ident">sg</label> *<a href="#line-211" class="ident">Segmenter</a>) <label for="r23" class="ident">LineIterator</label>() *<a href="#line-269" class="ident">LineIterator</a> {</code></span>
<span class="codeline" id="line-289"><code>	<span class="keyword">return</span> &amp;<a href="#line-269" class="ident">LineIterator</a>{<a href="#line-270" class="ident">attributeIterator</a>: <a href="#line-233" class="ident">attributeIterator</a>{<a href="#line-234" class="ident">src</a>: <label for="r22" class="ident">sg</label>, <a href="#line-237" class="ident">flag</a>: <a href="#line-26" class="ident">lineBoundary</a>}}</code></span>
<span class="codeline" id="line-290"><code>}</code></span>
<span class="codeline" id="line-291"><code></code></span>
<span class="codeline" id="line-292"><code><span class="comment">// Grapheme is the content of a grapheme delimited by the segmenter.</span></code></span>
<span class="codeline" id="line-293"><code><span class="keyword">type</span> <a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-Grapheme" class="ident">Grapheme</a> <span class="keyword">struct</span> {</code></span>
<span class="codeline" id="line-294"><code>	<span class="comment">// Text is a subslice of the original input slice, containing the delimited grapheme</span></code></span>
<span class="codeline" id="line-295"><code>	Text []<a href="../../../../../pkg/builtin.html#name-rune" class="ident">rune</a></code></span>
<span class="codeline" id="line-296"><code>	<span class="comment">// Offset is the start of the grapheme in the input rune slice</span></code></span>
<span class="codeline" id="line-297"><code>	Offset <a href="../../../../../pkg/builtin.html#name-int" class="ident">int</a></code></span>
<span class="codeline" id="line-298"><code>}</code></span>
<span class="codeline" id="line-299"><code></code></span>
<span class="codeline" id="line-300"><code><span class="comment">// GraphemeIterator provides a convenient way of</span></code></span>
<span class="codeline" id="line-301"><code><span class="comment">// iterating over the graphemes delimited by a `Segmenter`.</span></code></span>
<span class="codeline" id="line-302"><code><span class="keyword">type</span> <a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-GraphemeIterator" class="ident">GraphemeIterator</a> <span class="keyword">struct</span> {</code></span>
<span class="codeline" id="line-303"><code>	<a href="#line-233" class="ident">attributeIterator</a></code></span>
<span class="codeline" id="line-304"><code>}</code></span>
<span class="codeline" id="line-305"><code></code></span>
<span class="codeline" id="line-306"><code><span class="comment">// Next returns true if there is still a grapheme to process,</span></code></span>
<span class="codeline" id="line-307"><code><span class="comment">// and advances the iterator; or return false.</span></code></span>
<span class="codeline" id="line-308"><code><span class="keyword">func</span> (<label for="r24" class="ident">gr</label> *<a href="#line-302" class="ident">GraphemeIterator</a>) <label for="r25" class="ident">Next</label>() <a href="../../../../../pkg/builtin.html#name-bool" class="ident">bool</a> { <span class="keyword">return</span> <label for="r24" class="ident">gr</label>.<a href="#line-243" class="ident">next</a>() }</code></span>
<span class="codeline" id="line-309"><code></code></span>
<span class="codeline" id="line-310"><code><span class="comment">// Grapheme returns the current `Grapheme`</span></code></span>
<span class="codeline" id="line-311"><code><span class="keyword">func</span> (<label for="r26" class="ident">gr</label> *<a href="#line-302" class="ident">GraphemeIterator</a>) <label for="r27" class="ident">Grapheme</label>() <a href="#line-293" class="ident">Grapheme</a> {</code></span>
<span class="codeline" id="line-312"><code>	<span class="keyword">return</span> <a href="#line-293" class="ident">Grapheme</a>{</code></span>
<span class="codeline" id="line-313"><code>		<a href="#line-297" class="ident">Offset</a>: <label for="r26" class="ident">gr</label>.<a href="#line-236" class="ident">lastBreak</a>,</code></span>
<span class="codeline" id="line-314"><code>		<a href="#line-295" class="ident">Text</a>:   <label for="r26" class="ident">gr</label>.<a href="#line-234" class="ident">src</a>.<a href="#line-212" class="ident">text</a>[<label for="r26" class="ident">gr</label>.<a href="#line-236" class="ident">lastBreak</a>:<label for="r26" class="ident">gr</label>.<a href="#line-235" class="ident">pos</a>],</code></span>
<span class="codeline" id="line-315"><code>	}</code></span>
<span class="codeline" id="line-316"><code>}</code></span>
<span class="codeline" id="line-317"><code></code></span>
<span class="codeline" id="line-318"><code><span class="comment">// GraphemeIterator returns an iterator over the graphemes</span></code></span>
<span class="codeline" id="line-319"><code><span class="comment">// delimited in [Init].</span></code></span>
<span class="codeline" id="line-320"><code><span class="keyword">func</span> (<label for="r28" class="ident">sg</label> *<a href="#line-211" class="ident">Segmenter</a>) <label for="r29" class="ident">GraphemeIterator</label>() *<a href="#line-302" class="ident">GraphemeIterator</a> {</code></span>
<span class="codeline" id="line-321"><code>	<span class="keyword">return</span> &amp;<a href="#line-302" class="ident">GraphemeIterator</a>{<a href="#line-303" class="ident">attributeIterator</a>: <a href="#line-233" class="ident">attributeIterator</a>{<a href="#line-234" class="ident">src</a>: <label for="r28" class="ident">sg</label>, <a href="#line-237" class="ident">flag</a>: <a href="#line-31" class="ident">graphemeBoundary</a>}}</code></span>
<span class="codeline" id="line-322"><code>}</code></span>
<span class="codeline" id="line-323"><code></code></span>
<span class="codeline" id="line-324"><code><span class="comment">// Word is the content of a word delimited by the segmenter.</span></code></span>
<span class="codeline" id="line-325"><code><span class="comment">//</span></code></span>
<span class="codeline" id="line-326"><code><span class="comment">// More precisely, a word is formed by runes</span></code></span>
<span class="codeline" id="line-327"><code><span class="comment">// with the [Alphabetic] property, or with a General_Category of Number,</span></code></span>
<span class="codeline" id="line-328"><code><span class="comment">// delimited by the Word Boundary Unicode Property.</span></code></span>
<span class="codeline" id="line-329"><code><span class="comment">//</span></code></span>
<span class="codeline" id="line-330"><code><span class="comment">// See also https://unicode.org/reports/tr29/#Word_Boundary_Rules,</span></code></span>
<span class="codeline" id="line-331"><code><span class="comment">// http://unicode.org/reports/tr44/#Alphabetic and</span></code></span>
<span class="codeline" id="line-332"><code><span class="comment">// http://unicode.org/reports/tr44/#General_Category_Values</span></code></span>
<span class="codeline" id="line-333"><code><span class="keyword">type</span> <a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-Word" class="ident">Word</a> <span class="keyword">struct</span> {</code></span>
<span class="codeline" id="line-334"><code>	<span class="comment">// Text is a subslice of the original input slice, containing the delimited word</span></code></span>
<span class="codeline" id="line-335"><code>	Text []<a href="../../../../../pkg/builtin.html#name-rune" class="ident">rune</a></code></span>
<span class="codeline" id="line-336"><code>	<span class="comment">// Offset is the start of the word in the input rune slice</span></code></span>
<span class="codeline" id="line-337"><code>	Offset <a href="../../../../../pkg/builtin.html#name-int" class="ident">int</a></code></span>
<span class="codeline" id="line-338"><code>}</code></span>
<span class="codeline" id="line-339"><code></code></span>
<span class="codeline" id="line-340"><code><span class="keyword">type</span> <a href="../../../../../pkg/github.com/go-text/typesetting/segmenter.html#name-WordIterator" class="ident">WordIterator</a> <span class="keyword">struct</span> {</code></span>
<span class="codeline" id="line-341"><code>	<a href="#line-233" class="ident">attributeIterator</a></code></span>
<span class="codeline" id="line-342"><code></code></span>
<span class="codeline" id="line-343"><code>	inWord <a href="../../../../../pkg/builtin.html#name-bool" class="ident">bool</a> <span class="comment">// true if we have seen the start of a word</span></code></span>
<span class="codeline" id="line-344"><code>}</code></span>
<span class="codeline" id="line-345"><code></code></span>
<span class="codeline" id="line-346"><code><span class="comment">// Next returns true if there is still a word to process,</span></code></span>
<span class="codeline" id="line-347"><code><span class="comment">// and advances the iterator; or return false.</span></code></span>
<span class="codeline" id="line-348"><code><span class="keyword">func</span> (<label for="r30" class="ident">gr</label> *<a href="#line-340" class="ident">WordIterator</a>) <label for="r31" class="ident">Next</label>() <a href="../../../../../pkg/builtin.html#name-bool" class="ident">bool</a> {</code></span>
<span class="codeline" id="line-349"><code>	<label for="r32" class="ident">hasBoundary</label> := <label for="r30" class="ident">gr</label>.<a href="#line-243" class="ident">next</a>()</code></span>
<span class="codeline" id="line-350"><code>	<span class="keyword">if</span> !<label for="r32" class="ident">hasBoundary</label> {</code></span>
<span class="codeline" id="line-351"><code>		<span class="keyword">return</span> <a href="../../../../../pkg/builtin.html#name-false" class="ident">false</a></code></span>
<span class="codeline" id="line-352"><code>	}</code></span>
<span class="codeline" id="line-353"><code></code></span>
<span class="codeline" id="line-354"><code>	<span class="keyword">if</span> <label for="r30" class="ident">gr</label>.<a href="#line-343" class="ident">inWord</a> { <span class="comment">// we are have reached the END of a word</span></code></span>
<span class="codeline" id="line-355"><code>		<label for="r30" class="ident">gr</label>.<a href="#line-343" class="ident">inWord</a> = <a href="../../../../../pkg/builtin.html#name-false" class="ident">false</a></code></span>
<span class="codeline" id="line-356"><code>		<span class="keyword">return</span> <a href="../../../../../pkg/builtin.html#name-true" class="ident">true</a></code></span>
<span class="codeline" id="line-357"><code>	}</code></span>
<span class="codeline" id="line-358"><code></code></span>
<span class="codeline" id="line-359"><code>	<span class="comment">// do we start a word ? if so, mark it</span></code></span>
<span class="codeline" id="line-360"><code>	<span class="keyword">if</span> <label for="r30" class="ident">gr</label>.<a href="#line-235" class="ident">pos</a> &lt; <a href="../../../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r30" class="ident">gr</label>.<a href="#line-234" class="ident">src</a>.<a href="#line-212" class="ident">text</a>) {</code></span>
<span class="codeline" id="line-361"><code>		<label for="r30" class="ident">gr</label>.<a href="#line-343" class="ident">inWord</a> = <a href="../../../../../pkg/unicode.html" class="ident i0">unicode</a>.<a href="../../../../unicode/letter.go.html#line-157" class="ident">Is</a>(<a href="../../../../../pkg/github.com/go-text/typesetting/unicodedata.html" class="ident i1">ucd</a>.<a href="../unicodedata/word_break.go.html#line-1862" class="ident">Word</a>, <label for="r30" class="ident">gr</label>.<a href="#line-234" class="ident">src</a>.<a href="#line-212" class="ident">text</a>[<label for="r30" class="ident">gr</label>.<a href="#line-235" class="ident">pos</a>])</code></span>
<span class="codeline" id="line-362"><code>	}</code></span>
<span class="codeline" id="line-363"><code>	<span class="comment">// in any case, advance again</span></code></span>
<span class="codeline" id="line-364"><code>	<span class="keyword">return</span> <label for="r30" class="ident">gr</label>.<label for="r31" class="ident">Next</label>()</code></span>
<span class="codeline" id="line-365"><code>}</code></span>
<span class="codeline" id="line-366"><code></code></span>
<span class="codeline" id="line-367"><code><span class="comment">// Word returns the current `Word`</span></code></span>
<span class="codeline" id="line-368"><code><span class="keyword">func</span> (<label for="r33" class="ident">gr</label> *<a href="#line-340" class="ident">WordIterator</a>) <label for="r34" class="ident">Word</label>() <a href="#line-333" class="ident">Word</a> {</code></span>
<span class="codeline" id="line-369"><code>	<span class="keyword">return</span> <a href="#line-333" class="ident">Word</a>{</code></span>
<span class="codeline" id="line-370"><code>		<a href="#line-337" class="ident">Offset</a>: <label for="r33" class="ident">gr</label>.<a href="#line-236" class="ident">lastBreak</a>,</code></span>
<span class="codeline" id="line-371"><code>		<a href="#line-335" class="ident">Text</a>:   <label for="r33" class="ident">gr</label>.<a href="#line-234" class="ident">src</a>.<a href="#line-212" class="ident">text</a>[<label for="r33" class="ident">gr</label>.<a href="#line-236" class="ident">lastBreak</a>:<label for="r33" class="ident">gr</label>.<a href="#line-235" class="ident">pos</a>],</code></span>
<span class="codeline" id="line-372"><code>	}</code></span>
<span class="codeline" id="line-373"><code>}</code></span>
<span class="codeline" id="line-374"><code></code></span>
<span class="codeline" id="line-375"><code><span class="comment">// WordIterator returns an iterator over the word</span></code></span>
<span class="codeline" id="line-376"><code><span class="comment">// delimited in [Init].</span></code></span>
<span class="codeline" id="line-377"><code><span class="keyword">func</span> (<label for="r35" class="ident">sg</label> *<a href="#line-211" class="ident">Segmenter</a>) <label for="r36" class="ident">WordIterator</label>() *<a href="#line-340" class="ident">WordIterator</a> {</code></span>
<span class="codeline" id="line-378"><code>	<span class="comment">// check is we start at a word</span></code></span>
<span class="codeline" id="line-379"><code>	<label for="r37" class="ident">inWord</label> := <a href="../../../../../pkg/builtin.html#name-false" class="ident">false</a></code></span>
<span class="codeline" id="line-380"><code>	<span class="keyword">if</span> <a href="../../../../../pkg/builtin.html#name-len" class="ident">len</a>(<label for="r35" class="ident">sg</label>.<a href="#line-212" class="ident">text</a>) != <span class="lit-number">0</span> {</code></span>
<span class="codeline" id="line-381"><code>		<label for="r37" class="ident">inWord</label> = <a href="../../../../../pkg/unicode.html" class="ident i0">unicode</a>.<a href="../../../../unicode/letter.go.html#line-157" class="ident">Is</a>(<a href="../../../../../pkg/github.com/go-text/typesetting/unicodedata.html" class="ident i1">ucd</a>.<a href="../unicodedata/word_break.go.html#line-1862" class="ident">Word</a>, <label for="r35" class="ident">sg</label>.<a href="#line-212" class="ident">text</a>[<span class="lit-number">0</span>])</code></span>
<span class="codeline" id="line-382"><code>	}</code></span>
<span class="codeline" id="line-383"><code>	<span class="keyword">return</span> &amp;<a href="#line-340" class="ident">WordIterator</a>{<a href="#line-341" class="ident">attributeIterator</a>: <a href="#line-233" class="ident">attributeIterator</a>{<a href="#line-234" class="ident">src</a>: <label for="r35" class="ident">sg</label>, <a href="#line-237" class="ident">flag</a>: <a href="#line-41" class="ident">wordBoundary</a>}, <a href="#line-343" class="ident">inWord</a>: <label for="r37" class="ident">inWord</label>}</code></span>
<span class="codeline" id="line-384"><code>}</code></span>
</pre><pre id="footer">
<table><tr><td><img src="../../../../../png/zigo101-twitter.png"></td>
<td>The pages are generated with <a href="https://go101.org/apps-and-libs/golds.html"><b>Golds</b></a> <i>v0.7.1</i>. (GOOS=linux GOARCH=amd64)
<b>Golds</b> is a <a href="https://go101.org">Go 101</a> project developed by <a href="https://tapirgames.com">Tapir Liu</a>.
PR and bug reports are welcome and can be submitted to <a href="https://github.com/go101/golds">the issue list</a>.
Please follow <a href="https://twitter.com/zigo_101">@zigo_101</a> (reachable from the left QR code) to get the latest news of <b>Golds</b>.</td></tr></table></pre>